<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø³ÙˆØ¨Ø±Ù…Ø§Ø±ÙƒØª Ù…Ù† Ø¨Ø±Ù…Ø¬ Ø¬Ø§Ø³Ø± Ø§Ø´Ù„Ø§Ù - Offline</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab-btn.active {
            background: white;
            border-bottom-color: #007bff;
            color: #007bff;
            font-weight: bold;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn-primary { background: #007bff; color: white; }
        .btn-primary:hover { background: #0056b3; transform: translateY(-2px); }

        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #1e7e34; transform: translateY(-2px); }

        .btn-danger { background: #dc3545; color: white; }
        .btn-danger:hover { background: #c82333; transform: translateY(-2px); }

        .btn-warning { background: #ffc107; color: #212529; }
        .btn-warning:hover { background: #e0a800; transform: translateY(-2px); }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid #dee2e6;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .alert {
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-weight: 500;
        }

        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-danger { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .sale-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .total-section {
            background: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 18px;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .container {
                margin: 10px;
                border-radius: 10px;
            }
        }

        .low-stock {
            background-color: #fff3cd !important;
            color: #856404 !important;
        }

        .out-stock {
            background-color: #f8d7da !important;
            color: #721c24 !important;
        }

        .print-btn {
            background: #17a2b8;
            color: white;
        }

        .print-btn:hover {
            background: #138496;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ›’ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø³ÙˆØ¨Ø±Ù…Ø§Ø±ÙƒØª</h1>
            <p>Ù†Ø¸Ø§Ù… Ø´Ø§Ù…Ù„ ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹</p>
        </div>

        <div class="nav-tabs">
            <button class="tab-btn active" onclick="showTab('products')">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
            <button class="tab-btn" onclick="showTab('inventory')">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</button>
            <button class="tab-btn" onclick="showTab('sales')">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</button>
            <button class="tab-btn" onclick="showTab('suppliers')">Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</button>
            <button class="tab-btn" onclick="showTab('customers')">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
            <button class="tab-btn" onclick="showTab('reports')">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
        <div id="products" class="tab-content active">
            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
            <div class="form-group">
                <input type="text" id="productSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." onkeyup="filterTable('productsTable', this.value)">
            </div>
            <form id="productForm">
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:</label>
                    <input type="text" id="productName" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ÙƒÙˆØ¯:</label>
                    <input type="text" id="productCode" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø³Ø¹Ø±:</label>
                    <input type="number" id="productPrice" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø©:</label>
                    <input type="number" id="productQuantity" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†:</label>
                    <input type="number" id="productMinStock" value="5">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ÙØ¦Ø©:</label>
                    <select id="productCategory">
                        <option value="ØºØ°Ø§Ø¦ÙŠ">ØºØ°Ø§Ø¦ÙŠ</option>
                        <option value="Ù…Ø´Ø±ÙˆØ¨Ø§Øª">Ù…Ø´Ø±ÙˆØ¨Ø§Øª</option>
                        <option value="ØªÙ†Ø¸ÙŠÙ">ØªÙ†Ø¸ÙŠÙ</option>
                        <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
                <button type="button" class="btn btn-warning" onclick="clearForm('productForm')">Ø¬Ø¯ÙŠØ¯</button>
            </form>

            <div class="table-container">
                <table id="productsTable">
                    <thead>
                        <tr>
                            <th>Ø§Ù„ÙƒÙˆØ¯</th>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„Ø³Ø¹Ø±</th>
                            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</th>
                            <th>Ø§Ù„ÙØ¦Ø©</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
        <div id="inventory" class="tab-content">
            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h2>
            <div class="form-group">
                <input type="text" id="inventorySearch" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†..." onkeyup="filterTable('inventoryTable', this.value)">
            </div>
            <form id="inventoryForm">
                <div class="form-group">
                    <label>ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬:</label>
                    <input type="text" id="inventoryProductCode" required>
                </div>
                <div class="form-group">
                    <label>ÙƒÙ…ÙŠØ© Ø§Ù„Ø¥Ø¶Ø§ÙØ©:</label>
                    <input type="number" id="addQuantity" required>
                </div>
                <div class="form-group">
                    <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
                    <textarea id="inventoryNotes" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-success">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø®Ø²ÙˆÙ†</button>
            </form>

            <div class="table-container">
                <table id="inventoryTable">
                    <thead>
                        <tr>
                            <th>Ø§Ù„ÙƒÙˆØ¯</th>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</th>
                            <th>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª -->
        <div id="sales" class="tab-content">
            <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h2>
            <div class="form-group">
                <input type="text" id="saleProductSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø§Ù„ÙƒÙˆØ¯ Ø£Ùˆ Ø§Ù„Ø§Ø³Ù…..." onkeyup="searchProductForSale(this.value)">
            </div>
            <div id="saleItems"></div>
            <div class="total-section">
                <div class="total-row">
                    <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span>
                    <span id="subtotal">0.00 Ø¯.Ø¬</span>
                </div>
                <div class="total-row">
                    <span>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (19%):</span>
                    <span id="tax">0.00 Ø¯.Ø¬</span>
                </div>
                <hr>
                <div class="total-row" style="font-size: 22px; color: #28a745;">
                    <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                    <span id="total">0.00 Ø¯.Ø¬</span>
                </div>
            </div>
            <div style="margin-top: 20px;">
                <input type="text" id="customerNameSale" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                <button class="btn btn-primary print-btn" onclick="completeSale()">Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
                <button class="btn btn-warning" onclick="clearSale()">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† -->
        <div id="suppliers" class="tab-content">
            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</h2>
            <div class="form-group">
                <input type="text" id="supplierSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ±Ø¯..." onkeyup="filterTable('suppliersTable', this.value)">
            </div>
            <form id="supplierForm">
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯:</label>
                    <input type="text" id="supplierName" required>
                </div>
                <div class="form-group">
                    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
                    <input type="tel" id="supplierPhone">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</label>
                    <textarea id="supplierAddress" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ±Ø¯</button>
                <button type="button" class="btn btn-warning" onclick="clearForm('supplierForm')">Ø¬Ø¯ÙŠØ¯</button>
            </form>

            <div class="table-container">
                <table id="suppliersTable">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                            <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
        <div id="customers" class="tab-content">
            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
            <div class="form-group">
                <input type="text" id="customerSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…ÙŠÙ„..." onkeyup="filterTable('customersTable', this.value)">
            </div>
            <form id="customerForm">
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
                    <input type="text" id="customerName" required>
                </div>
                <div class="form-group">
                    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
                    <input type="tel" id="customerPhone">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</label>
                    <textarea id="customerAddress" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
                <button type="button" class="btn btn-warning" onclick="clearForm('customerForm')">Ø¬Ø¯ÙŠØ¯</button>
            </form>

            <div class="table-container">
                <table id="customersTable">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                            <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
        <div id="reports" class="tab-content">
            <h2>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h2>
            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="generateReport('daily')">ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ</button>
                <button class="btn btn-primary" onclick="generateReport('monthly')">ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ</button>
                <button class="btn btn-success" onclick="exportToCSV('sales')">ØªØµØ¯ÙŠØ± Ù…Ø¨ÙŠØ¹Ø§Øª CSV</button>
                <button class="btn btn-success" onclick="exportToCSV('products')">ØªØµØ¯ÙŠØ± Ù…Ù†ØªØ¬Ø§Øª CSV</button>
            </div>
            <div id="reportContent"></div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
    <div id="invoiceModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('invoiceModal')">&times;</span>
            <div id="invoiceContent"></div>
            <button class="btn btn-primary print-btn" onclick="printInvoice()">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
        </div>
    </div>

    <script>
        // ========================================
        // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… localStorage
        // ========================================
        class SupermarketDB {
            constructor() {
                this.db = {
                    products: [],
                    suppliers: [],
                    customers: [],
                    sales: [],
                    inventoryLog: []
                };
                this.loadData();
            }

            loadData() {
                const saved = localStorage.getItem('supermarket_db');
                if (saved) {
                    this.db = { ...this.db, ...JSON.parse(saved) };
                }
            }

            saveData() {
                localStorage.setItem('supermarket_db', JSON.stringify(this.db));
            }

            // Ù…Ù†ØªØ¬Ø§Øª
            addProduct(product) {
                const id = Date.now().toString();
                const newProduct = { id, ...product, createdAt: new Date().toISOString() };
                this.db.products.push(newProduct);
                this.saveData();
                return newProduct;
            }

            updateProduct(id, updates) {
                const index = this.db.products.findIndex(p => p.id === id);
                if (index !== -1) {
                    this.db.products[index] = { ...this.db.products[index], ...updates };
                    this.saveData();
                    return true;
                }
                return false;
            }

            deleteProduct(id) {
                this.db.products = this.db.products.filter(p => p.id !== id);
                this.saveData();
            }

            getProducts() {
                return this.db.products;
            }

            // Ù…Ø®Ø²ÙˆÙ†
            updateInventory(productCode, quantity, notes = '') {
                const product = this.db.products.find(p => p.code === productCode);
                if (product) {
                    product.quantity = (parseFloat(product.quantity) || 0) + parseFloat(quantity);
                    product.updatedAt = new Date().toISOString();
                    
                    this.db.inventoryLog.push({
                        id: Date.now().toString(),
                        productCode,
                        productName: product.name,
                        quantity,
                        notes,
                        date: new Date().toISOString()
                    });
                    this.saveData();
                    return product;
                }
                return null;
            }

            // Ù…Ø¨ÙŠØ¹Ø§Øª
            addSale(sale) {
                const id = Date.now().toString();
                const newSale = { id, ...sale, date: new Date().toISOString() };
                this.db.sales.push(newSale);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                sale.items.forEach(item => {
                    const product = this.db.products.find(p => p.code === item.code);
                    if (product) {
                        product.quantity -= item.quantity;
                    }
                });
                
                this.saveData();
                return newSale;
            }

            getSales() {
                return this.db.sales;
            }

            // Ù…ÙˆØ±Ø¯ÙˆÙ† ÙˆØ¹Ù…Ù„Ø§Ø¡
            addSupplier(supplier) {
                const id = Date.now().toString();
                const newSupplier = { id, ...supplier };
                this.db.suppliers.push(newSupplier);
                this.saveData();
                return newSupplier;
            }

            updateSupplier(id, updates) {
                const index = this.db.suppliers.findIndex(s => s.id === id);
                if (index !== -1) {
                    this.db.suppliers[index] = { ...this.db.suppliers[index], ...updates };
                    this.saveData();
                    return true;
                }
                return false;
            }

            deleteSupplier(id) {
                this.db.suppliers = this.db.suppliers.filter(s => s.id !== id);
                this.saveData();
            }

            getSuppliers() {
                return this.db.suppliers;
            }

            addCustomer(customer) {
                const id = Date.now().toString();
                const newCustomer = { id, ...customer };
                this.db.customers.push(newCustomer);
                this.saveData();
                return newCustomer;
            }

            updateCustomer(id, updates) {
                const index = this.db.customers.findIndex(c => c.id === id);
                if (index !== -1) {
                    this.db.customers[index] = { ...this.db.customers[index], ...updates };
                    this.saveData();
                    return true;
                }
                return false;
            }

            deleteCustomer(id) {
                this.db.customers = this.db.customers.filter(c => c.id !== id);
                this.saveData();
            }

            getCustomers() {
                return this.db.customers;
            }

            // ØªÙ‚Ø§Ø±ÙŠØ±
            getDailySales(date) {
                const today = new Date(date);
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                
                return this.db.sales.filter(sale => {
                    const saleDate = new Date(sale.date);
                    return saleDate >= today && saleDate < tomorrow;
                });
            }

            getMonthlySales(year, month) {
                const start = new Date(year, month - 1, 1);
                const end = new Date(year, month, 0);
                
                return this.db.sales.filter(sale => {
                    const saleDate = new Date(sale.date);
                    return saleDate >= start && saleDate <= end;
                });
            }
        }

        // ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const db = new SupermarketDB();

        // ========================================
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        // ========================================
        function showTab(tabName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø®ØªØ§Ø±
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„ØªØ¨ÙˆÙŠØ¨
            if (tabName === 'products') loadProducts();
            if (tabName === 'inventory') loadInventory();
            if (tabName === 'suppliers') loadSuppliers();
            if (tabName === 'customers') loadCustomers();
        }

        function clearForm(formId) {
            document.getElementById(formId).reset();
        }

        function filterTable(tableId, searchTerm) {
            const table = document.getElementById(tableId);
            const rows = table.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm.toLowerCase()) ? '' : 'none';
            });
        }

        // ========================================
        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        // ========================================
        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const product = {
                name: document.getElementById('productName').value,
                code: document.getElementById('productCode').value,
                price: parseFloat(document.getElementById('productPrice').value),
                quantity: parseFloat(document.getElementById('productQuantity').value),
                minStock: parseFloat(document.getElementById('productMinStock').value),
                category: document.getElementById('productCategory').value
            };

            const editId = this.dataset.editId;
            if (editId) {
                db.updateProduct(editId, product);
                delete this.dataset.editId;
                showAlert('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } else {
                db.addProduct(product);
                showAlert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }

            this.reset();
            loadProducts();
        });

        function loadProducts() {
            const products = db.getProducts();
            const tbody = document.querySelector('#productsTable tbody');
            tbody.innerHTML = '';

            products.forEach(product => {
                const row = document.createElement('tr');
                const stockStatus = product.quantity <= product.minStock ? 
                    (product.quantity === 0 ? 'Ù†ÙØ¯' : 'Ù‚Ù„ÙŠÙ„') : 'Ø¬ÙŠØ¯';
                
                row.className = product.quantity === 0 ? 'out-stock' : 
                               product.quantity <= product.minStock ? 'low-stock' : '';
                
                row.innerHTML = `
                    <td>${product.code}</td>
                    <td>${product.name}</td>
                    <td>${product.price.toFixed(2)} Ø¯.Ø¬</td>
                    <td>${product.quantity}</td>
                    <td>${product.minStock}</td>
                    <td>${product.category}</td>
                    <td>
                        <button class="btn btn-warning" onclick="editProduct('${product.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
                        <button class="btn btn-danger" onclick="deleteProduct('${product.id}')">Ø­Ø°Ù</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function editProduct(id) {
            const product = db.getProducts().find(p => p.id === id);
            if (product) {
                document.getElementById('productName').value = product.name;
                document.getElementById('productCode').value = product.code;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productQuantity').value = product.quantity;
                document.getElementById('productMinStock').value = product.minStock;
                document.getElementById('productCategory').value = product.category;
                
                document.getElementById('productForm').dataset.editId = id;
                showTab('products');
            }
        }

        function deleteProduct(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) {
                db.deleteProduct(id);
                loadProducts();
                showAlert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        }

        // ========================================
        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        // ========================================
        document.getElementById('inventoryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const code = document.getElementById('inventoryProductCode').value;
            const quantity = document.getElementById('addQuantity').value;
            const notes = document.getElementById('inventoryNotes').value;
            
            const product = db.updateInventory(code, quantity, notes);
            if (product) {
                showAlert(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${quantity} Ù…Ù† ${product.name} Ù„Ù„Ù…Ø®Ø²ÙˆÙ†`, 'success');
                this.reset();
                loadInventory();
            } else {
                showAlert('Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'danger');
            }
        });

        function loadInventory() {
            const products = db.getProducts();
            const tbody = document.querySelector('#inventoryTable tbody');
            tbody.innerHTML = '';

            products.forEach(product => {
                const row = document.createElement('tr');
                const status = product.quantity === 0 ? 'Ù†ÙØ¯' : 
                              product.quantity <= product.minStock ? 'Ù†Ù‚Øµ' : 'ÙƒØ§ÙÙŠ';
                const statusClass = product.quantity === 0 ? 'out-stock' : 
                                   product.quantity <= product.minStock ? 'low-stock' : '';
                
                row.className = statusClass;
                row.innerHTML = `
                    <td>${product.code}</td>
                    <td>${product.name}</td>
                    <td>${product.quantity}</td>
                    <td>${product.minStock}</td>
                    <td>${status}</td>
                    <td>${new Date(product.updatedAt || product.createdAt).toLocaleDateString('ar-DZ')}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // ========================================
        // Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
        // ========================================
        let saleItems = [];

        function searchProductForSale(query) {
            if (query.length < 2) return;
            
            const products = db.getProducts().filter(p => 
                p.code.includes(query) || p.name.toLowerCase().includes(query.toLowerCase())
            );
            
            if (products.length === 1) {
                addSaleItem(products[0]);
            } else if (products.length > 1) {
                // Ø¹Ø±Ø¶ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª (ÙŠÙ…ÙƒÙ† ØªØ·ÙˆÙŠØ±Ù‡Ø§ Ù„Ù‚Ø§Ø¦Ù…Ø© Ù…Ù†Ø³Ø¯Ù„Ø©)
                showAlert(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${products.length} Ù…Ù†ØªØ¬`, 'info');
            }
        }

        function addSaleItem(product) {
            const existing = saleItems.find(item => item.code === product.code);
            if (existing && existing.quantity >= product.quantity) {
                showAlert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø®Ø²ÙˆÙ† ÙƒØ§ÙÙŠ', 'danger');
                return;
            }

            if (existing) {
                existing.quantity += 1;
            } else {
                saleItems.push({
                    code: product.code,
                    name: product.name,
                    price: product.price,
                    quantity: 1
                });
            }
            updateSaleDisplay();
        }

        function updateSaleDisplay() {
            const container = document.getElementById('saleItems');
            container.innerHTML = '';

            saleItems.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'sale-item';
                itemDiv.innerHTML = `
                    <div style="flex: 2;">${item.name} (${item.code})</div>
                    <div style="flex: 1;">${item.price.toFixed(2)} Ø¯.Ø¬</div>
                    <div style="flex: 1;">
                        <input type="number" value="${item.quantity}" min="1" 
                               onchange="updateSaleItem(${index}, this.value)" style="width: 60px;">
                    </div>
                    <div style="flex: 1; font-weight: bold;">
                        ${(item.price * item.quantity).toFixed(2)} Ø¯.Ø¬
                    </div>
                    <button class="btn btn-danger" onclick="removeSaleItem(${index})" style="padding: 5px 10px;">Ø­Ø°Ù</button>
                `;
                container.appendChild(itemDiv);
            });

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
            const subtotal = saleItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = subtotal * 0.19;
            const total = subtotal + tax;

            document.getElementById('subtotal').textContent = `${subtotal.toFixed(2)} Ø¯.Ø¬`;
            document.getElementById('tax').textContent = `${tax.toFixed(2)} Ø¯.Ø¬`;
            document.getElementById('total').textContent = `${total.toFixed(2)} Ø¯.Ø¬`;
        }

        function updateSaleItem(index, quantity) {
            saleItems[index].quantity = parseInt(quantity);
            updateSaleDisplay();
        }

        function removeSaleItem(index) {
            saleItems.splice(index, 1);
            updateSaleDisplay();
        }

        function clearSale() {
            saleItems = [];
            document.getElementById('saleProductSearch').value = '';
            document.getElementById('customerNameSale').value = '';
            updateSaleDisplay();
        }

        function completeSale() {
            if (saleItems.length === 0) {
                showAlert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„Ø³Ù„Ø©', 'danger');
                return;
            }

            const customerName = document.getElementById('customerNameSale').value || 'Ø¹Ù…ÙŠÙ„ Ø¹Ø§Ø¨Ø±';
            const subtotal = saleItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = subtotal * 0.19;
            const total = subtotal + tax;

            const sale = {
                customerName,
                items: [...saleItems],
                subtotal,
                tax,
                total,
                itemsCount: saleItems.reduce((sum, item) => sum + item.quantity, 0)
            };

            db.addSale(sale);
            showInvoice(sale);
            clearSale();
            showAlert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        // ========================================
        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† ÙˆØ§Ù„Ø¹Ù…Ù„Ø§Ø¡
        // ========================================
        document.getElementById('supplierForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const supplier = {
                name: document.getElementById('supplierName').value,
                phone: document.getElementById('supplierPhone').value,
                address: document.getElementById('supplierAddress').value
            };

            const editId = this.dataset.editId;
            if (editId) {
                db.updateSupplier(editId, supplier);
                delete this.dataset.editId;
            } else {
                db.addSupplier(supplier);
            }
            this.reset();
            loadSuppliers();
            showAlert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ±Ø¯ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        });

        function loadSuppliers() {
            const suppliers = db.getSuppliers();
            const tbody = document.querySelector('#suppliersTable tbody');
            tbody.innerHTML = '';

            suppliers.forEach(supplier => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${supplier.name}</td>
                    <td>${supplier.phone || '-'}</td>
                    <td>${supplier.address || '-'}</td>
                    <td>
                        <button class="btn btn-warning" onclick="editSupplier('${supplier.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
                        <button class="btn btn-danger" onclick="deleteSupplier('${supplier.id}')">Ø­Ø°Ù</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function editSupplier(id) {
            const supplier = db.getSuppliers().find(s => s.id === id);
            if (supplier) {
                document.getElementById('supplierName').value = supplier.name;
                document.getElementById('supplierPhone').value = supplier.phone || '';
                document.getElementById('supplierAddress').value = supplier.address || '';
                document.getElementById('supplierForm').dataset.editId = id;
            }
        }

        function deleteSupplier(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ±Ø¯ØŸ')) {
                db.deleteSupplier(id);
                loadSuppliers();
            }
        }

        document.getElementById('customerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const customer = {
                name: document.getElementById('customerName').value,
                phone: document.getElementById('customerPhone').value,
                address: document.getElementById('customerAddress').value
            };

            const editId = this.dataset.editId;
            if (editId) {
                db.updateCustomer(editId, customer);
                delete this.dataset.editId;
            } else {
                db.addCustomer(customer);
            }
            this.reset();
            loadCustomers();
            showAlert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        });

        function loadCustomers() {
            const customers = db.getCustomers();
            const tbody = document.querySelector('#customersTable tbody');
            tbody.innerHTML = '';

            customers.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.name}</td>
                    <td>${customer.phone || '-'}</td>
                    <td>${customer.address || '-'}</td>
                    <td>
                        <button class="btn btn-warning" onclick="editCustomer('${customer.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
                        <button class="btn btn-danger" onclick="deleteCustomer('${customer.id}')">Ø­Ø°Ù</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function editCustomer(id) {
            const customer = db.getCustomers().find(c => c.id === id);
            if (customer) {
                document.getElementById('customerName').value = customer.name;
                document.getElementById('customerPhone').value = customer.phone || '';
                document.getElementById('customerAddress').value = customer.address || '';
                document.getElementById('customerForm').dataset.editId = id;
            }
        }

        function deleteCustomer(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ')) {
                db.deleteCustomer(id);
                loadCustomers();
            }
        }

        // ========================================
        // Ø§Ù„ÙÙˆØ§ØªÙŠØ± ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø©
        // ========================================
        function showInvoice(sale) {
            const modal = document.getElementById('invoiceModal');
            const content = document.getElementById('invoiceContent');
            
            content.innerHTML = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2>ğŸ›’ ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h2>
                    <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${new Date().toLocaleDateString('ar-DZ')} ${new Date().toLocaleTimeString('ar-DZ')}</p>
                    <p><strong>Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${sale.customerName}</p>
                </div>
                <div style="margin-bottom: 20px;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f8f9fa;">
                                <th style="border: 1px solid #ddd; padding: 10px;">Ø§Ù„Ù…Ù†ØªØ¬</th>
                                <th style="border: 1px solid #ddd; padding: 10px;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                <th style="border: 1px solid #ddd; padding: 10px;">Ø§Ù„Ø³Ø¹Ø±</th>
                                <th style="border: 1px solid #ddd; padding: 10px;">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sale.items.map(item => `
                                <tr>
                                    <td style="border: 1px solid #ddd; padding: 10px;">${item.name}</td>
                                    <td style="border: 1px solid #ddd; padding: 10px; text-align: center;">${item.quantity}</td>
                                    <td style="border: 1px solid #ddd; padding: 10px;">${item.price.toFixed(2)} Ø¯.Ø¬</td>
                                    <td style="border: 1px solid #ddd; padding: 10px; font-weight: bold;">
                                        ${(item.price * item.quantity).toFixed(2)} Ø¯.Ø¬
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                <div style="text-align: left; font-size: 18px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:</span>
                        <span>${sale.subtotal.toFixed(2)} Ø¯.Ø¬</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© (19%):</span>
                        <span>${sale.tax.toFixed(2)} Ø¯.Ø¬</span>
                    </div>
                    <hr style="border: 2px solid #333;">
                    <div style="display: flex; justify-content: space-between; font-size: 22px; font-weight: bold; color: #28a745;">
                        <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span>
                        <span>${sale.total.toFixed(2)} Ø¯.Ø¬</span>
                    </div>
                    <div style="margin-top: 20px; padding: 15px; background: #e9ecef; border-radius: 8px; font-size: 14px;">
                        <strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹: ${sale.itemsCount}</strong>
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function printInvoice() {
            const content = document.getElementById('invoiceContent').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; direction: rtl; }
                            table { width: 100%; border-collapse: collapse; }
                            th, td { border: 1px solid #ddd; padding: 10px; text-align: right; }
                            th { background: #f8f9fa; }
                            @media print { body { margin: 0; } }
                        </style>
                    </head>
                    <body>${content}</body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // ========================================
        // Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
        // ========================================
        function generateReport(type) {
            const content = document.getElementById('reportContent');
            let sales = [];
            
            if (type === 'daily') {
                sales = db.getDailySales(new Date().toDateString());
                content.innerHTML = `
                    <h3>ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
                    <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${new Date().toLocaleDateString('ar-DZ')}</p>
                    <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª:</strong> ${sales.length}</p>
                    <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª:</strong> ${sales.reduce((sum, s) => sum + s.total, 0).toFixed(2)} Ø¯.Ø¬</p>
                `;
            } else if (type === 'monthly') {
                const now = new Date();
                sales = db.getMonthlySales(now.getFullYear(), now.getMonth() + 1);
                content.innerHTML = `
                    <h3>ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠ</h3>
                    <p><strong>Ø§Ù„Ø´Ù‡Ø±:</strong> ${now.toLocaleDateString('ar-DZ', { month: 'long', year: 'numeric' })}</p>
                    <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª:</strong> ${sales.length}</p>
                    <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª:</strong> ${sales.reduce((sum, s) => sum + s.total, 0).toFixed(2)} Ø¯.Ø¬</p>
                `;
            }
        }

        function exportToCSV(type) {
            let data, filename, headers;
            
            if (type === 'sales') {
                data = db.getSales();
                headers = ['Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„Ø¹Ù…ÙŠÙ„', 'Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹', 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ', 'Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©', 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ'];
                filename = `Ù…Ø¨ÙŠØ¹Ø§Øª_${new Date().toISOString().split('T')[0]}.csv`;
            } else {
                data = db.getProducts();
                headers = ['Ø§Ù„ÙƒÙˆØ¯', 'Ø§Ù„Ø§Ø³Ù…', 'Ø§Ù„Ø³Ø¹Ø±', 'Ø§Ù„ÙƒÙ…ÙŠØ©', 'Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰', 'Ø§Ù„ÙØ¦Ø©'];
                filename = `Ù…Ù†ØªØ¬Ø§Øª_${new Date().toISOString().split('T')[0]}.csv`;
            }

            const csv = [
                headers.join(','),
                ...data.map(row => Object.values(type === 'sales' ? {
                    date: new Date(row.date).toLocaleDateString('ar-DZ'),
                    customer: row.customerName,
                    itemsCount: row.itemsCount,
                    subtotal: row.subtotal,
                    tax: row.tax,
                    total: row.total
                } : row).map(field => `"${field}"`).join(','))
            ].join('\n');

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        // ========================================
        // ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø©
        // ========================================
        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            document.querySelector('.tab-content.active').insertBefore(alert, document.querySelector('.tab-content.active').firstChild);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡Ø§
        window.onclick = function(event) {
            const modal = document.getElementById('invoiceModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
        window.addEventListener('load', function() {
            loadProducts();
            loadInventory();
            loadSuppliers();
            loadCustomers();
        });

        // Ø¯Ø¹Ù… Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Enter Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬)
        document.getElementById('saleProductSearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchProductForSale(this.value);
            }
        });

        // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ù…Ø³Ø§ÙØ© Ø¨Ø¹Ø¯ Ø§Ù„Ø¨Ø­Ø«
        document.addEventListener('keydown', function(e) {
            if (e.code === 'Space' && document.activeElement.id === 'saleProductSearch') {
                const query = document.getElementById('saleProductSearch').value;
                const products = db.getProducts().filter(p => 
                    p.code.includes(query) || p.name.toLowerCase().includes(query.toLowerCase())
                );
                if (products.length === 1) {
                    e.preventDefault();
                    addSaleItem(products[0]);
                }
            }
        });
    </script>
</body>
</html>
