<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ورشة عباس اشلاف – حجز مواعيد الصيانة</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Cairo', system-ui, sans-serif;
      background: linear-gradient(135deg, #f0f4f8, #d9e2ec);
      color: #1e293b;
      min-height: 100vh;
      padding: 20px 15px;
      line-height: 1.6;
    }
    .container { max-width: 1100px; margin: 0 auto; }
    h1 { text-align:center; margin: 1.5rem 0 2.5rem; color:#0f172a; font-size:2.1rem; }
    
    .cards-wrapper {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
    }
    
    .card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      overflow: hidden;
    }
    
    .card-header {
      background: #1e40af;
      color: white;
      padding: 1.3rem 1.8rem;
      font-size: 1.35rem;
      font-weight: 600;
    }
    
    .card-body { padding: 1.8rem; }
    
    .working-hours li {
      display: flex;
      justify-content: space-between;
      padding: 0.8rem 0;
      border-bottom: 1px dashed #e2e8f0;
    }
    .working-hours li:last-child { border-bottom: none; }
    .closed { color: #ef4444; font-weight: 600; }
    
    .booked-list { list-style: none; }
    .booked-item {
      padding: 1.1rem;
      margin-bottom: 1rem;
      background: #f8fafc;
      border-radius: 10px;
      border-right: 5px solid #3b82f6;
    }
    .booked-header { display: flex; justify-content: space-between; font-weight: 600; margin-bottom: 0.4rem; }
    .status {
      font-size: 0.9rem;
      padding: 0.3rem 0.8rem;
      border-radius: 999px;
      background: #dbeafe;
      color: #1d4ed8;
    }
    .empty { text-align:center; color:#64748b; font-style:italic; padding:2rem 0; }

    /* نموذج الحجز */
    #booking-form { background:white; border-radius:16px; box-shadow:0 10px 40px rgba(0,0,0,0.08); padding:2.5rem; }
    .form-grid { display:grid; grid-template-columns:1fr 1fr; gap:1.4rem; }
    .full { grid-column:1/-1; }
    label { display:block; margin-bottom:0.5rem; font-weight:500; color:#334155; }
    input, select, textarea {
      width:100%; padding:0.9rem; border:1px solid #cbd5e1; border-radius:8px; font-size:1rem;
    }
    input:focus, select:focus, textarea:focus { outline:none; border-color:#3b82f6; box-shadow:0 0 0 3px rgba(59,130,246,0.15); }
    button {
      background:#2563eb; color:white; border:none; padding:1rem 2.5rem; font-size:1.1rem; font-weight:600;
      border-radius:10px; cursor:pointer; margin:2rem auto 0; display:block;
    }
    button:hover { background:#1d4ed8; }
    #message { margin-top:1.5rem; text-align:center; font-weight:500; }
    .success { color:#15803d; }
    .error   { color:#b91c1c; }
    
    /* نصيحة الأمان */
    #safety-advice {
      margin-top: 1.5rem;
      padding: 1.2rem;
      background: #fefce8;
      border: 1px solid #eab308;
      border-radius: 8px;
      color: #713f12;
      font-size: 1rem;
    }
    #safety-advice h4 {
      margin-bottom: 0.8rem;
      color: #854d0e;
    }
    
    @media (max-width: 700px) { .form-grid { grid-template-columns:1fr; } }
  </style>
</head>
<body>

<div class="container">
  <h1>ورشة جاسر – حجز مواعيد الصيانة</h1>

  <div class="cards-wrapper">

    <!-- مواقيت العمل -->
    <div class="card">
      <div class="card-header">مواقيت العمل</div>
      <div class="card-body">
        <ul class="working-hours">
          <li><span>الأحد</span>     <span>08:00 – 18:00</span></li>
          <li><span>الإثنين</span>   <span>08:00 – 18:00</span></li>
          <li><span>الثلاثاء</span>  <span>08:00 – 18:00</span></li>
          <li><span>الأربعاء</span>  <span>08:00 – 18:00</span></li>
          <li><span>الخميس</span>    <span>08:00 – 18:00</span></li>
          <li><span>الجمعة</span>    <span class="closed">مغلق</span></li>
          <li><span>السبت</span>     <span>09:00 – 15:00</span></li>
        </ul>
      </div>
    </div>

    <!-- الحجوزات الحالية (real-time) -->
    <div class="card">
      <div class="card-header">المواعيد المحجوزة</div>
      <div class="card-body">
        <ul class="booked-list" id="booked-list">
          <li class="empty">جاري تحميل المواعيد...</li>
        </ul>
      </div>
    </div>

  </div>

  <!-- نموذج الحجز -->
  <div id="booking-form">
    <h2 style="text-align:center; margin-bottom:2rem;">احجز موعد جديد</h2>
    
    <form id="appointment-form">
      <div class="form-grid">
        <div>
          <label>الاسم الكامل</label>
          <input type="text" id="name" required>
        </div>
        <div>
          <label>رقم الهاتف</label>
          <input type="tel" id="phone" required pattern="0[5-7][0-9]{8}">
        </div>
        <div>
          <label>موديل السيارة</label>
          <input type="text" id="car" required placeholder="مثال: تويوتا كامري 2020">
        </div>
        <div>
          <label>رقم اللوحة (اختياري)</label>
          <input type="text" id="plate">
        </div>
        <div>
          <label>تاريخ الموعد</label>
          <input type="date" id="date" required>
        </div>
        <div>
          <label>الوقت</label>
          <select id="time" required>
            <option value="">اختر الوقت</option>
            <option value="08:00">08:00 – 09:30</option>
            <option value="09:30">09:30 – 11:00</option>
            <option value="11:00">11:00 – 12:30</option>
            <option value="13:00">13:00 – 14:30</option>
            <option value="14:30">14:30 – 16:00</option>
            <option value="16:00">16:00 – 17:30</option>
          </select>
        </div>
        <div class="full">
          <label>المشكلة الطارئة (مساعد طارئ)</label>
          <select id="emergency_issue" required>
            <option value="">-- اختر المشكلة --</option>
            <option value="oil_light">لمبة الزيت تضيء</option>
            <option value="overheating">تسخين زائد للمحرك</option>
            <option value="flat_tire">إطار مثقوب أو مفلطح</option>
            <option value="dead_battery">البطارية ميتة (السيارة لا تبدأ)</option>
            <option value="fluid_leak">تسرب سائل (زيت، ماء، إلخ)</option>
            <option value="brake_issue">مشكلة في الفرامل</option>
            <option value="engine_smoke">دخان من المحرك</option>
            <option value="other">أخرى</option>
          </select>
        </div>
        <div class="full" id="safety-advice" style="display: none;"></div>
        <div class="full">
          <label>ملاحظات إضافية</label>
          <textarea id="notes" rows="3" placeholder="وصف المشكلة إن وجدت..."></textarea>
        </div>
      </div>

      <button type="submit">تأكيد الحجز</button>
    </form>

    <div id="message"></div>
  </div>
</div>

<script>
  // ────────────────────────────────────────────────
  // Firebase Configuration (من عندك)
  // ────────────────────────────────────────────────
  const firebaseConfig = {
    apiKey: "AIzaSyCLCSPOV1nuk5RvQiSJcjc18rxXbC0Ei9Y",
    authDomain: "bot-djasser-achlaf-4494.firebaseapp.com",
    databaseURL: "https://bot-djasser-achlaf-4494-default-rtdb.firebaseio.com",
    projectId: "bot-djasser-achlaf-4494",
    storageBucket: "bot-djasser-achlaf-4494.firebasestorage.app",
    messagingSenderId: "500557963512",
    appId: "1:500557963512:web:a32bf5c21ba508662b5b0d"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const bookedList = document.getElementById('booked-list');
  const form = document.getElementById('appointment-form');
  const messageDiv = document.getElementById('message');
  const emergencySelect = document.getElementById('emergency_issue');
  const safetyAdviceDiv = document.getElementById('safety-advice');

  // ────────────────────────────────────────────────
  // عرض الحجوزات في الوقت الفعلي
  // ────────────────────────────────────────────────
  const appointmentsRef = db.ref('appointments');

  appointmentsRef.on('value', (snapshot) => {
    bookedList.innerHTML = '';

    if (!snapshot.exists() || Object.keys(snapshot.val() || {}).length === 0) {
      bookedList.innerHTML = '<li class="empty">لا توجد حجوزات مسجلة حالياً</li>';
      return;
    }

    const data = snapshot.val();
    Object.entries(data).forEach(([key, appt]) => {
      const li = document.createElement('li');
      li.className = 'booked-item';
      li.innerHTML = `
        <div class="booked-header">
          <span>${appt.date || 'غير محدد'}</span>
          <span class="status">محجوز</span>
        </div>
        <div>${appt.time || 'غير محدد'}</div>
        <div style="color:#475569; margin-top:0.4rem;">
          ${appt.name} – ${appt.car || ''} – ${appt.issue || ''}
        </div>
      `;
      bookedList.appendChild(li);
    });
  });

  // ضبط الحد الأدنى للتاريخ = اليوم
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('date').min = new Date().toISOString().split('T')[0];
  });

  // ────────────────────────────────────────────────
  // عرض نصيحة أمان طارئة بناءً على الاختيار
  // ────────────────────────────────────────────────
  const safetyProtocols = {
    oil_light: `
      <h4>نصيحة أمان فورية:</h4>
      <p>إذا أضاءت لمبة الزيت، توقف السيارة مباشرة في مكان آمن بعيداً عن الطريق. أطفئ المحرك ودع السيارة تبرد تماماً لمدة 30 دقيقة على الأقل. لا تقد السيارة أكثر لتجنب تلف المحرك. بعد ذلك، احجز موعد عند عباس الميكانيكي لفحص مستوى الزيت والضغط.</p>
    `,
    overheating: `
      <h4>نصيحة أمان فورية:</h4>
      <p>توقف في مكان آمن، أطفئ المحرك فوراً، ودع السيارة تبرد لساعة على الأقل. لا تفتح غطاء الرادياتير إلا بعد التبريد الكامل لتجنب الحروق. شغل المدفأة لمساعدة في التبريد إذا لزم الأمر. احجز موعد لفحص نظام التبريد.</p>
    `,
    flat_tire: `
      <h4>نصيحة أمان فورية:</h4>
      <p>حافظ على سيطرة المقود، ابطئ تدريجياً، وتوقف في سطح مستوٍ آمن بعيداً عن الحركة. شغل أنوار الطوارئ، وضع مثلث التحذير خلف السيارة. إذا كنت تستطيع، غير الإطار بنفسك؛ وإلا انتظر المساعدة داخل السيارة. احجز موعد لإصلاح أو استبدال الإطار.</p>
    `,
    dead_battery: `
      <h4>نصيحة أمان فورية:</h4>
      <p>توقف في مكان آمن، شغل أنوار الطوارئ. إذا كان لديك كوابل شحن، اطلب مساعدة من سيارة أخرى، لكن كن حذراً من الشرارات. انتظر داخل السيارة إذا كنت تنتظر المساعدة. احجز موعد لفحص البطارية والنظام الكهربائي.</p>
    `,
    fluid_leak: `
      <h4>نصيحة أمان فورية:</h4>
      <p>توقف في مكان آمن، أطفئ المحرك، وتحقق من نوع السائل (زيت، ماء، إلخ) دون لمسه إذا كان ساخناً. لا تقد السيارة إذا كان التسرب كبيراً لتجنب تلف المحرك أو الحريق. احجز موعد فوري لإصلاح التسرب.</p>
    `,
    brake_issue: `
      <h4>نصيحة أمان فورية:</h4>
      <p>إذا شعرت بمشكلة في الفرامل، ابطئ باستخدام فرامل اليد تدريجياً، وتوقف في مكان آمن. شغل أنوار الطوارئ ولا تقد أكثر. انتظر المساعدة داخل السيارة. احجز موعد لفحص نظام الفرامل فوراً.</p>
    `,
    engine_smoke: `
      <h4>نصيحة أمان فورية:</h4>
      <p>توقف فوراً في مكان آمن، أطفئ المحرك، وابتعد عن السيارة لتجنب الحريق. شغل أنوار الطوارئ وضع مثلث التحذير. لا تفتح غطاء المحرك إذا كان هناك دخان كثيف. احجز موعد لفحص المحرك.</p>
    `,
    other: `
      <h4>نصيحة أمان عامة:</h4>
      <p>توقف في مكان آمن، شغل أنوار الطوارئ، وابق داخل السيارة مع قفل الأبواب. لا تحاول إصلاحاً ذاتياً إلا إذا كنت خبيراً. احجز موعد وصف المشكلة في الملاحظات لمساعدتنا.</p>
    `
  };

  emergencySelect.addEventListener('change', (e) => {
    const issue = e.target.value;
    if (issue && safetyProtocols[issue]) {
      safetyAdviceDiv.innerHTML = safetyProtocols[issue];
      safetyAdviceDiv.style.display = 'block';
    } else {
      safetyAdviceDiv.style.display = 'none';
    }
  });

  // ────────────────────────────────────────────────
  // حفظ حجز جديد
  // ────────────────────────────────────────────────
  form.addEventListener('submit', (e) => {
    e.preventDefault();

    const newAppointment = {
      name:   document.getElementById('name').value.trim(),
      phone:  document.getElementById('phone').value.trim(),
      car:    document.getElementById('car').value.trim(),
      plate:  document.getElementById('plate').value.trim() || null,
      date:   document.getElementById('date').value,
      time:   document.getElementById('time').value,
      issue:  document.getElementById('emergency_issue').value,
      notes:  document.getElementById('notes').value.trim() || null,
      createdAt: firebase.database.ServerValue.TIMESTAMP
    };

    if (!newAppointment.name || !newAppointment.phone || !newAppointment.date || !newAppointment.time || !newAppointment.issue) {
      messageDiv.textContent = 'يرجى ملء جميع جميع الحقول المطلوبة';
      messageDiv.className = 'error';
      return;
    }

    appointmentsRef.push(newAppointment)
      .then(() => {
        messageDiv.textContent = 'تم حفظ الحجز بنجاح! سيتم التواصل معك قريباً.';
        messageDiv.className = 'success';
        form.reset();
        safetyAdviceDiv.style.display = 'none';
      })
      .catch((error) => {
        messageDiv.textContent = 'حدث خطأ أثناء الحفظ: ' + error.message;
        messageDiv.className = 'error';
        console.error(error);
      });
  });
</script>

</body>
</html>

